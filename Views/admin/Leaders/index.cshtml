@model IEnumerable<yogloansdotnet.Models.LeadersModel>

@{
    ViewData["Title"] = "Leaders";
    Layout = "~/Views/admin/Shared/_Layout.cshtml";
}



<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="card">

             @if (TempData["Success"] != null)
                    {
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            @TempData["Success"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }

                    @if (TempData["Error"] != null)
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            @TempData["Error"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }
                    <div class="card-title" style="width:100%; display:flex; justify-content:space-between; padding: 10px;">
                   <h4  style="">Leaders</h4>
                   <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#myModal">Add Leaders +</button>
                   </div>
                   <div class="card-body" style="width:100%; display:grid; grid-template-columns:repeat(3,1fr); gap:15px;">
                @foreach (var profile in Model){
                    <div class="card" style="width:100%; margin-bottom:5px;">
                           <div class="form-group" style="height:100%; width:100%;">

                                <div class="card-header" style=" width:100%; display:flex; justify-content:space-between;">
                                <p >@profile.Name <br>
                                    @profile.Post
                                </p>
                                    <i class="fas fa-eye" onclick="director(@profile.Id)" ></i>
                                </div>
                                <div class="card-body" style="background-image: url('@profile.Profile'); height: 250px; width: 100%; background-position: center; background-size: cover; background-repeat: no-repeat;">


                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-success" onclick="edit(@profile.Id , '@profile.Name' , '@profile.Post' , '@profile.Profile','@profile.About')">Edit</button>
                                    <button class="btn btn-danger" onclick="deleted(@profile.Id)">Delete</button>
                                </div>
                            </div>
                    </div>
                   }
                   </div>
            </div>
        </div>
    </div>
</div>

<div id="myModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog">
   <form class="modal-content" method="post" action="/admin/Leaders/add-Leaders" enctype="multipart/form-data" id="leaderForm">
   <input name="id" type="hidden" id="id1">
            <div class="modal-header">
                <h5 class="modal-title">Add Directors</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                @Html.AntiForgeryToken()
                <div class="col-12">
                    <div class="col-12" style="margin-top: 20px;">
                        <div class="col-12">
                            <div class="col-6" id="parent" style="padding:20px; display:flex; flex-direction:column; gap:10px; width:100%;">
                              
                                <div id="points-container">
                                    <div class="point-input-group" style="">
                                        <label>Name</label>
                                        <input type="text"  name="Name" class="form-control" id="name1">
                                        <label>Image</label>
                                        <input type="file" name="Profile" class="form-control" id="profile1" onchange="previewImage(event)">
                                        <span id="profileFileName" style="font-size: 0.9em; color: #555;"></span>
                                        <img id="profilePreview" src="#" alt="Image Preview" style="display:none; max-width:100px; margin-top:10px;" />
                                        <label>Post</label>
                                        <input type="text" name="Post" class="form-control" id="post1">
                                        <label>About</label>
                                        <textarea name="About" class="form-control" id="about1"></textarea>
                                        <button type="button" class="remove-point" onclick="removePoint(this)" style="display:none;">Ã—</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <!-- <button type="button" class="btn btn-primary" onclick="addmore()">Add More Points</button> -->
                <button type="submit" class="btn btn-success">Save</button>
            </div>
        </form>
    </div>
</div>

<div id="aboutmodel" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog">
   <form class="modal-content" method="post" action="" enctype="multipart/form-data">
   <input name="id" type="hidden" id="id1">
            <div class="modal-header">
                <!-- <h5 class="modal-title">Add Directors</h5> -->
                <div class="form-group" style="display:flex; gap:15px;">
                    <div id="profile-image">
                       
                    </div>
                    <div id="name-post" >
                    
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                @Html.AntiForgeryToken()
                <div class="col-12">
                    <div class="col-12" style="margin-top: 20px;">
                        <div class="col-12">
                            <div class="col-6" id="parent" style="padding:20px; display:flex; flex-direction:column; gap:10px; width:100%;">
                              
                                <div id="points-container">
                                    <div class="point-input-group" style="" id="about-profile">
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
           
        </form>
    </div>
</div>
<script>
    function edit(id, name, post, profile, about) {
        document.getElementById('id1').value = id;
        document.getElementById('name1').value = name;
        document.getElementById('post1').value = post;
        document.getElementById('about1').value = about;
        // Set file name display
        document.getElementById('profileFileName').textContent = profile ? profile.split('/').pop() : '';
        
        // Set image preview
        var preview = document.getElementById('profilePreview');
        if (profile) {
            preview.src = profile;
            preview.style.display = 'block';
        } else {
            preview.src = '#';
            preview.style.display = 'none';
        }
        // Clear file input
        document.getElementById('profile1').value = '';
        // Make file input not required when editing
        document.getElementById('profile1').required = false;
        // Show modal
        var myModal = new bootstrap.Modal(document.getElementById('myModal'));
        myModal.show();
    }

    function previewImage(event) {
        var input = event.target;
        var preview = document.getElementById('profilePreview');
        var fileNameSpan = document.getElementById('profileFileName');
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(input.files[0]);
            fileNameSpan.textContent = input.files[0].name;
        } else {
            preview.src = '#';
            preview.style.display = 'none';
            fileNameSpan.textContent = '';
        }
    }

    // Set required when adding new director
    document.querySelector('[data-bs-target="#myModal"]').addEventListener('click', function() {
        document.getElementById('profile1').required = true;
        document.getElementById('profileFileName').textContent = '';
        document.getElementById('profilePreview').style.display = 'none';
        document.getElementById('id1').value = '';
        document.getElementById('name1').value = '';
        document.getElementById('post1').value = '';
        document.getElementById('about1').value = '';
    });


     function deleted(id){
   
    if (confirm('Are you sure you want to delete this Director?')) {
      $.ajax({
        url: '/admin/Leaders/delete/' + id,
        type: 'POST',
        headers: {
          'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
        },
        success: function(result) {
          if (result.success) {
            alert("Deleted Successfully");
            window.location.reload();

            // Use the correct class selector to find and remove the element
            $('.report-item_' + id + '.' + cleanedTitle).remove();
          } else {
            alert('Error deleting report: ' + result.message);
          }
        },
        error: function(xhr, status, error) {
          alert('Error deleting report: ' + error);
        }
      });
    }
    }


     function director(id) {
  var myModal = new bootstrap.Modal(document.getElementById('aboutmodel'));

  // Clear previous content
  var image = document.getElementById('profile-image');
  var name_post = document.getElementById('name-post');
  var about = document.getElementById('about-profile');

  image.innerHTML = '';
  name_post.innerHTML = '';
  about.innerHTML = '';

  $.ajax({
    url: '/admin/Leaders/get-model/' + id,
    type: 'GET',
    success: function(response) {
      if (response.success) {
        const data = response.data;

        // Set content
        image.innerHTML = `<img src="${data.profile}" class="img-fluid" alt="Profile Image" style="width:60px; height:60px; border-radius:50%;"/>`;
        name_post.innerHTML = `<p>${data.name}</p><p>${data.post}</p>`;
        about.innerHTML = `<p>${data.about}</p>`;

        // Show modal
        myModal.show();
      } else {
        alert(response.message || 'Director not found');
      }
    },
    error: function(xhr, status, error) {
      alert('Error fetching director data: ' + error);
    }
  });
}

$('#leaderForm').on('submit', function(e) {
    e.preventDefault(); // Prevent default form submission

    $.ajax({
        url: $(this).attr('action'),
        type: 'POST',
        data: new FormData(this),
        contentType: false,
        processData: false,
        success: function(response) {
            alert("Leaders Added Successfully");
            window.location.reload();
        },
        error: function(xhr) {
           alert("Something went wrong: " + xhr.responseText);
        }
    });
});
    
</script>